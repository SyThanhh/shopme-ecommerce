package com.shopme;

import java.io.*;
import java.security.KeyStore;
import java.security.cert.CertificateFactory;
import java.security.cert.X509Certificate;

public class trustStoreUpdater {
	public static void main(String[] args) throws Exception {
        // Nội dung chứng chỉ PEM (thay thế với chứng chỉ thực tế của bạn)
        String pemCertificate = 
            "-----BEGIN CERTIFICATE-----\n" +
            "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA7P7fFmUVHlhE1Xc7Q2xT\n" +
            "o/QdgyTfayZCwAW7JlDjmZK17b9EdMz+ESql3/pzFfKMErphj4gVwpS9O3YO9QbN\n" +
            "5hWpx+9tGgGkFmgoLPvQY8tZJRhfnoqsmFBbgzLn3pPSyDd//ykgY1gpZmXZwHWi\n" +
            "Ffwse28czF76JowVsbN1QhHX7AvuHHL0nBe95/sS6HLoHgEy7xSeHLcgtRffFSC6\n" +
            "K3Y9nS2Xn5q32jqQG3nlPqPbqtG51qVdGVtbtklX4RImG9wbg6VAxOG5z/vde0Z\n" +
            "XrOgdBGRavkmX8OZ3p7wTHsgtdg9lgE9P0AiNmUBcxo1nXXDczOxV5Y4DDiFOFxQ\n" +
            "Xr06oT5uX7gdfQ2wb5+PR5PUbxdhMCgOa6YsiVftg7A+z84BamGUs97QT5hXvW8c\n" +
            "-----END CERTIFICATE-----";

        // Chuyển chuỗi chứng chỉ thành InputStream
        byte[] certBytes = pemCertificate.getBytes();
        ByteArrayInputStream certStream = new ByteArrayInputStream(certBytes);

        // Chuyển chứng chỉ PEM thành X509Certificate
        CertificateFactory certFactory = CertificateFactory.getInstance("X.509");
        X509Certificate certificate = (X509Certificate) certFactory.generateCertificate(certStream);

        // Tải TrustStore mặc định
        String trustStorePath = System.getProperty("java.home") + "/lib/security/cacerts";
        String alias = "smtp-cert";

        KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());
        try (java.io.FileInputStream trustStoreStream = new java.io.FileInputStream(trustStorePath)) {
            trustStore.load(trustStoreStream, "changeit".toCharArray());
        }

        // Thêm chứng chỉ vào TrustStore
        trustStore.setCertificateEntry(alias, certificate);

        // Lưu lại TrustStore
        try (java.io.FileOutputStream trustStoreOut = new java.io.FileOutputStream(trustStorePath)) {
            trustStore.store(trustStoreOut, "changeit".toCharArray());
        }

        System.out.println("Chứng chỉ đã được thêm vào TrustStore.");
    }
}
